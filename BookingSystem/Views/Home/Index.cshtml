@{
//Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link href="~/Scripts/jquery-ui.min.css" rel="stylesheet" />
    <title>Booking airline tickets</title>
    <link href="~/Content/style.css" rel="stylesheet" type="text/css" />
    <script src="~/Scripts/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js" type="text/javascript"></script>
    <script src="~/Scripts/jquery-ui-1.12.1.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            var flightId;
            var milliseconds;
            var returnId = 0;
            //hent alle origin elementer fra routes tabellen
            $.ajax({
                url: '/Home/GetOrigin',
                type: 'GET',
                dataType: 'json',
                success: function (originList) {
                    showDropDown1(originList);
                },
                error: function () {
                    alert("Problem rendering data. Please try again later");
                }
            });

            //vis alle byer man kan reise fra
            function showDropDown1(originList) {
                var result = "";
                for (var i in originList) {
                    result += "<option value='" + originList[i] + "'>" + originList[i] + "</option>";
                }
                $("#drop1").empty().append(result);
            }

            //opprett en hendelse på dropdown-listen når siden lastes
            $("#drop1").click(function () {
                var chosenOrigin = $(this).val();
                $.ajax({
                    url: '/Home/GetDestination',
                    type: 'GET',
                    data: { fromOrigin: chosenOrigin },
                    dataType: 'json',
                    success: function (destinationList) {
                        showDropDown2(destinationList);
                    },
                    error: function (x, y, z) {
                        alert("Problem rendering data. Please try again later");
                    }
                });
            });

            //vis alle elementer dropdown list nr 2
            function showDropDown2(destinationList) {
                var result = "";
                for (var i in destinationList) {
                    result += "<option value='" + destinationList[i] + "'>" + destinationList[i] + "</option>";
                    $("#drop2").empty().append(result);
                }
            }

            //hent avganger når knappen search trykkes
            $("#searchButton").click(function () {
                $("#drop1").prop("disabled", true);
                $("#drop2").prop("disabled", true);
                $("#drop3").prop("disabled", true);
                $("#datepicker").prop("disabled", true);
                $(this).prop("disabled", true);
                var from = $("#drop1").val();
                var to = $("#drop2").val();
                var nr = $("#drop3").val();
                var date = new Date($("#datepicker").val());
                milliseconds = date.getTime();
                alert(date);
                alert(milliseconds)
                $.ajax({
                    url: '/Home/GetSchedule',
                    type: 'GET',
                    data: { fromOrigin: from, toDestination: to, passengers: nr, date: milliseconds },
                    dataType: 'json',
                    success: function (scheduleList) {
                        $("#flights").empty().append(showFlights(scheduleList));
                    },
                    error: function (x, y, x) {
                        $("#flights").empty().append(x.toString());
                    }
                });
            });

            //vis avganger
            function showFlights(scheduleList) {
                if (scheduleList.length == 0) {
                    $("#return").empty().append("</br></br>No flights matching your criteria");
                    $("#returnFlights").css('visibility', 'hidden');
                    return;
                }
                var data = "<form><table class='table'><tr><th>Select</th><th>Departure</th><th>Arrival</th><th class='price'>Price</th></tr>";
                for (var i in scheduleList) {
                    var depDate = getDate(scheduleList[i].departureDate);
                    var arrDate = getDate(scheduleList[i].arrivalDate);
                    data += "<tr><td><input type='radio' name='flightList' id='flightList' value='" + scheduleList[i].id + "' ></td>" + "<td>" + depDate + "</td><td>" + arrDate + "</td><td class='price'>" + scheduleList[i].price + "</td></tr>";
                }
                data += "</form>"
                alert(data);
                $("#bookButton").css('visibility', 'visible');
                $("#returnFlights").css('visibility', 'visible');
                return data;
            }

            //convertere milisekunder til lesbar dato-string
            function getDate(milis) {
                var date = new Date(milis);
                var string = date.toUTCString();
                return string;
            }

            $("#datepicker").datepicker();

            //gå til booking siden når book knappen trykkes
            $("#book").click(function () {
                if ($('input:radio:checked').length > 0) {
                    var nr = $("#drop3").val();
                    flightId = $('#flights input:radio:checked').attr('value');
                    alert("Outbound id in book" + flightId);
                    returnId = $('#return input:radio:checked').attr('value');
                    if (returnId == null) {
                        returnId = 0;
                    }
                    alert(returnId);
                    window.location = '/Home/BookFlight?flightId=' + flightId + '&passengers=' + nr + '&returnId=' + returnId;
                } else {
                    alert("Choose a flight");
                } 
            });

            $("#returnFlights").click(function () {
                if ($('input:radio:checked').length > 0) {
                    flightId = $('#flights input:radio:checked').attr('value');
                    alert("Outbound id" + flightId);
                    var arrivalMillis = 0;
                    $.ajax({
                        url: '/Home/GetArrivalOutbound',
                        type: 'GET',
                        data: { id: flightId },
                        dataType: 'json',
                        success: function (millis) {
                            arrivalMillis = millis;
                            alert("arrival millis" + arrivalMillis);
                            var from = $("#drop2").val();
                            var to = $("#drop1").val();
                            var nr = $("#drop3").val();
                            $.ajax({
                                url: '/Home/GetSchedule',
                                type: 'GET',
                                data: { fromOrigin: from, toDestination: to, passengers: nr, date: arrivalMillis },
                                dataType: 'json',
                                success: function (scheduleList) {
                                    $("#return").empty().append(showFlights(scheduleList));
                                },
                                error: function (x, y, x) {
                                    $("#return").empty().append(x.toString());
                                }
                            });
                        },
                        error: function (x, y, x) {
                            alert("Error fetching arrival date");
                            arrivalMillis = 0;
                        }
                    });
                    jQuery(":radio").attr('disabled', true);
                    
                } else {
                    alert("Choose an outbound flight");
                } 
            });
                
        });

    </script>
</head>
<body>
    <h3>Book a flight</h3>
    <div class="dropDown">
        <div class="row">
            <div id="dropDown1" class="col col-sm-2">
                <div class="label">From:</div><br />
                <select id="drop1" class="btn btn-primary btn-lg dropdown-toggle"></select>
            </div>
            <div id="dropDown2" class="col col-sm-2">
                <div class="label">To: </div><br />
                <select id="drop2" class="btn btn-primary btn-lg dropdown-toggle"></select>
            </div>
            <div id="dropDown3" class="col col-sm-2">
                <div class="label">Passengers: </div><br />
                <select id="drop3" class="btn btn-primary btn-lg dropdown-toggle">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
            </div>
            <div id="date" class="class="col col-sm-2">
                <div class="label">Date: </div><br />
                <input type="text" id="datepicker" class="btn btn-primary btn-lg" style="margin:18px;" />
            </div>
            </div></br>
        <p><button id="searchButton" class="btn btn-lg btn-primary" name="search">Search flights</button></p>
    </div>
    <div id="flights">
    </div>
    <div id="return">
        <button id="returnFlights" class="btn-success btn-lg" style="visibility:hidden;">Show return flights</button>
    </div>
    <div id="bookButton" style="visibility: hidden">
        <button id="book" class="btn btn-lg btn-primary" name="book" >Book selected flight</button>
    </div>
</body>
</html>