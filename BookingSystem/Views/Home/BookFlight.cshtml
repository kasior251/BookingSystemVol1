@{
    ViewBag.Title = "BookFlight";
    var nr = (int)Session["Passengers"];
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link href="~/Scripts/jquery-ui.min.css" rel="stylesheet" />
    <title>Booking airline tickets</title>
    <script src="~/Scripts/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script type="text/javascript">
        $(function () {
            $("#next").click(function () {
                for (i = 1; i <= @(nr); i++) {
                    $("#fname"+i).prop('disabled', true);
                    $("#lname"+i).prop('disabled', true);
                    $("#bdate"+i).prop('disabled', true);
                }

                $("#payment").css("visibility", "visible");
            });

            $("#paymentOpts").click(function () {
                $("#pay").css("visibility", "visible");
            })

            $("#pay").click(function () {
                var method = $("#paymentOpts").val();
                if (method == "card") {
                    $("#confirm").empty().append("<table><tr><th>Card number</th>" +
                        "<td><input type='text' style='width: 40px;' maxlength = '4' /><input type='text' style='width: 40px;' maxlength = '4'  /><input type='text;' style='width: 40px;' maxlength = '4'  /><input type='text' style='width: 40px;' maxlength = '4'  /></td></tr>" +
                        "<tr><th>expiration date</th><td><select><option>January</option><option>February</option><option>March</option><option>April</option><option>May</option><option>June</option><option>July</option><option>August</option><option>September</option><option>October</option><option>November</option><option>December</option></select><select><option>2017</option><option>2018</option><option>2019</option><option>2020</option></td></tr>" +
                        "<tr><th>CVC</th><td><input type='text' style='width: 30px;' maxlength = '3' />");
                } else {
                    $("#confirm").empty().append("bla bla bla - add button");
                }
                $("#confirmButton").css('visibility', 'visible');
            });

            $("#confirmPayment").click(function () {
                var fnames = [];
                var lnames = []
                var bdates = []
                for (i = 1; i <= @(nr); i++) {
                    fnames.push($("#fname" + i).val());
                    lnames.push($("#lname" + i).val());
                    bdates.push($("#bdate" + i).val());
                }
                $.ajax({
                    url: '/Home/Summary',
                    type: 'POST',
                    dataType: 'json',
                    data: { firstNames: fnames, lastNames: lnames, birthDates: bdates },
                    success: function () {
                        window.location = '/Home/ShowConfirmation';
                    },
                    error: function () {
                        window.location = '/Home/Error';
                    }
                });
                
            });
        });
    </script>
</head>
<body>
    <div id="passengers">
        @for (int i = 0; i < nr; i++)
            {
            <h4>Passenger @(i + 1)</h4>
            <table>
                <tr><th>First name: </th><td><input type="text" id="fname@(i + 1)" /></td></tr>
                <tr><th>Last name: </th><td><input type="text" id="lname@(i + 1)" /></td></tr>
                <tr><th>Birth date: </th><td><input type="text" id="bdate@(i + 1)" /></td></tr>
            </table>
        }
        <button id="next" class="btn btn-primary">Next</button>
    </div>
        
    <div id="payment" style="visibility: hidden">
        <table>
            <tr><th>Payment mathod</th><td><select id="paymentOpts"> 
                 <option value="card">Mastercard/Visa</option>
                 <option value="transfer">Bank transfer</option></select></td></tr>
            <tr><th id="cardNo" style="visibility: hidden"></th></tr>
        </table>
        <button id="pay" class="btn btn-success" style="visibility: hidden">Next</button>
    </div>
    <div id="confirm"></div>
    <div id="confirmButton" style="visibility: hidden">
        <button id="confirmPayment" class="btn btn-success">Confrim your booking</button>
    </div>
</body>
</html>
